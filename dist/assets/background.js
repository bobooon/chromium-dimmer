import{g as i}from"./settings.js";async function o(t){try{const a=t?[await chrome.tabs.get(t)]:await chrome.tabs.query({active:!0});await Promise.allSettled(a.map(async e=>{e.id&&await chrome.tabs.sendMessage(e.id,{action:"update",payload:{settings:await s(e.id)}})}))}catch{}}async function s(t){const a=i();a.global=(await chrome.storage.local.get(["_global"]))._global||a.global;try{const e=t?await chrome.tabs.get(t):(await chrome.tabs.query({currentWindow:!0,active:!0})).pop();if(e?.id&&e?.url){await chrome.scripting.executeScript({target:{tabId:e.id},func:()=>!0});const{hostname:r}=new URL(e.url);a.url.hostname=r,a.url=(await chrome.storage.local.get([r]))[r]||a.url}}catch{}return a}async function c(t){(t.url.hostname==="*"||t.url.mode==="global")&&await chrome.storage.local.set({_global:t.global}),t.url.hostname!=="*"&&await chrome.storage.local.set({[t.url.hostname]:t.url}),await o()}chrome.runtime.onMessage.addListener((t,a,e)=>{switch(t.type){case"getSettings":return s().then(r=>e(r)),!0;case"saveSettings":return c(t.payload).then(()=>e(!0)),!0;case"resetSettings":return chrome.storage.local.clear().then(()=>o().then(()=>e(!0))),!0}});chrome.tabs.onUpdated.addListener(async(t,a)=>{a.status==="complete"&&await o(t)});chrome.tabs.onActivated.addListener(async t=>await o(t.tabId));chrome.commands.onCommand.addListener(async t=>{if(t==="toggle"){const a=await s();a.url.on=!a.url.on,await c(a)}});
